<style>
  .checkbox-row {
    display: flex;
    align-items: center;
    gap: 0.5em;
    margin-bottom: 0.5em;
  }

  fieldset {
    border: 1px solid #888;
    border-radius: 4px;
    padding: 0.75em;
    margin-bottom: 1em;
    background-color: #f9f9f9;
  }

  legend {
    font-weight: bold;
    padding: 0 0.5em;
  }
</style>

<form class="greyhawk-encounters">
  <!-- Encounter System -->
  <div class="form-group">
    <label for="encounterSystem">Encounter System:</label>
    <select name="encounterSystem">
      <option value="dmg">DMG Standard Tables</option>
      <option value="wog">World of Greyhawk</option>
    </select>
  </div>

  <!-- Encounter Context Shared -->
  <fieldset>
    <legend>Encounter Context</legend>

    <div class="form-group">
      <label for="terrain">Terrain Type:</label>
      <select name="terrain">
        {{#each terrainTypes}}
          <option value="{{this.id}}">{{this.label}}</option>
        {{/each}}
      </select>
    </div>

    <div class="form-group">
      <label for="population">Population Density:</label>
      <select name="population">
        {{#each populationTypes}}
          <option value="{{this.id}}">{{this.label}}</option>
        {{/each}}
      </select>
    </div>

    <div class="form-group">
      <label for="climate">Climate:</label>
      <select name="climate">
        {{#each climateTypes}}
          <option value="{{this.id}}">{{this.label}}</option>
        {{/each}}
      </select>
    </div>

    <div class="form-group time-of-day-group">
      <label for="timeOfDay">Time of Day:</label>
      <select name="timeOfDay">
        {{#each timesOfDay}}
          <option value="{{this.id}}">{{this.label}}</option>
        {{/each}}
      </select>
    </div>

    <div class="checkbox-row">
      <input type="checkbox" name="forceEncounter" id="forceEncounter">
      <label for="forceEncounter">Force Encounter (Testing Only)</label>
    </div>

    <div class="checkbox-row">
      <input type="checkbox" name="isPatrolled" id="isPatrolled">
      <label for="isPatrolled">Area is Patrolled (enables patrol encounter rolls)</label>
    </div>

    <div class="checkbox-row">
      <input type="checkbox" name="isWarZone" id="isWarZone">
      <label for="isWarZone">Is War Zone (double patrol chance)</label>
    </div>

    <!-- Add this after the existing buttons in the button-group -->
    <div class="button-group">
      <button type="button" class="roll-encounter-button">Roll Encounter</button>
      <button type="button" class="check-lost-button">Check if Lost</button>
      <button type="button" class="treasure-generator-button">Treasure Generator</button>
    </div>
  </fieldset>

    <!-- NEW SECTION: ADD HERE -->
  <fieldset class="dmg-timing-rules">
    <legend>DMG Encounter Timing Rules</legend>
    
    <!-- Compact reference table -->
    <div class="timing-reference">
      <table class="compact-timing-table">
        <tr><td><strong>Forest/Marsh:</strong></td><td>All times (6 checks/day)</td></tr>
        <tr><td><strong>Scrub:</strong></td><td>Morning, Evening, Night, Pre-dawn</td></tr>
        <tr><td><strong>Plain/Hills:</strong></td><td>Morning, Evening, Midnight</td></tr>
        <tr><td><strong>Mountains:</strong></td><td>Morning, Night</td></tr>
        <tr><td><strong>Desert:</strong></td><td>Morning, Night, Pre-dawn</td></tr>
      </table>
    </div>
    
    <!-- Dynamic warning -->
    <div class="timing-warning" style="display: none;"></div>
    
    <!-- Quick override for large parties -->
    <div class="checkbox-row">
      <input type="checkbox" name="largeTravelingParty" id="largeTravelingParty">
      <label for="largeTravelingParty">Large traveling party (100+ creatures) - ignores timing rules</label>
    </div>
  </fieldset>
  <!-- END NEW SECTION -->

  <!-- DMG-Specific Section -->
  <div class="dmg-system-container" style="display: none;">
    <fieldset>
      <legend>DMG Options</legend>

      <div class="form-group">
        <label for="dmgEncounterType">Encounter Type:</label>
        <select name="dmgEncounterType">
          <option value="outdoor">Outdoor</option>
          <option value="dungeon">Dungeon</option>
          <option value="underwater">Underwater</option>
          <option value="waterborne">Waterborne</option>
          <option value="city">City/Town</option>
          <option value="airborne">Airborne</option>
          <option value="astral">Astral Plane</option>
          <option value="ethereal">Ethereal Plane</option>
        </select>
      </div>

      <!-- Subsections are shown dynamically via JS -->
      <div class="dmg-dungeon-options" style="display: none;">
        <div class="form-group">
          <label for="dungeonLevel">Dungeon Level:</label>
          <input type="number" name="dungeonLevel" value="1" min="1" max="20">
        </div>
        <div class="form-group">
          <label>Wandering Monster Check</label>
          <div class="form-fields">
            <select name="periodicDieSize">
              <option value="4">d4</option>
              <option value="6" selected>d6</option>
              <option value="8">d8</option>
              <option value="10">d10</option>
              <option value="12">d12</option>
              <option value="20">d20</option>
              <option value="100">d100</option>
            </select>
            <span>Success on roll of</span>
            <input type="number" name="periodicSuccessValue" value="1" min="1" max="100">
            <span>or less</span>
          </div>
        </div>
      </div>
    </fieldset>
  </div>

  <!-- WoG Regional Section -->
  <div class="wog-regional-options" style="display: none;">
    <fieldset>
      <legend>World of Greyhawk Region</legend>

      <div class="form-group">
        <label for="regionType">Region Category:</label>
        <select name="regionType">
          {{#each regionTypes}}
            <option value="{{this.id}}">{{this.label}}</option>
          {{/each}}
        </select>
      </div>

      <div class="form-group">
        <label for="region">Specific Region:</label>
        <select name="region">
          <!-- Populated dynamically -->
        </select>
      </div>
    </fieldset>
  </div>

  <!-- Calendar Options -->
  <fieldset>
    <legend>Calendar Settings</legend>
    <div class="checkbox-row">
      <input type="checkbox" name="useSimpleCalendar" id="useSimpleCalendar" {{#if useSimpleCalendar}}checked{{/if}}>
      <label for="useSimpleCalendar">Use Simple Calendar for Time of Day/Season</label>
    </div>

    {{#if useSimpleCalendar}}
      <div class="simple-calendar-info">
        {{#if timeInfo}}
          <p><strong>Current Date:</strong> {{timeInfo.day}}/{{timeInfo.month}}/{{timeInfo.year}}</p>
          <p><strong>Current Time:</strong> {{timeInfo.hour}}:{{timeInfo.minute}}</p>
          <p><strong>Time of Day:</strong> {{timeInfo.timeOfDay}}</p>
          <p><strong>Season:</strong> {{timeInfo.season}}</p>
          <p><strong>Weather:</strong> {{timeInfo.weather}}</p>
        {{else}}
          <p>Simple Calendar data not available</p>
        {{/if}}
      </div>
    {{/if}}
  </fieldset>

  <!-- Buttons -->
  <div class="button-group">
    <button type="button" class="roll-encounter-button">Roll Encounter</button>
    <button type="button" class="check-lost-button">Check if Lost</button>
  </div>
</form>
